`https://www.mafengwo.cn/hotel/38322.html`

遇见无限debugger

![image-20260119210146950](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119210146950.png)

遇见这种匿名函数 多半就是构造器 的产物 所以我们直接 hook 构造器

```js
var _constructor = constructor;

Function.prototype.constructor = function (s) {
  if (s == "debugger") {
    //console.log(s);
    return null;
  }
  return _constructor(s);
};
```

点击 继续 发现 不触发 debugger了

开始翻页

![image-20260119210256502](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119210256502.png)

可以看看网络请求 

![image-20260119210315274](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119210315274.png)

发现 就这两个要分析 所以我们分析一下

# _ts

首先分析 ts是什么 多半是时间戳 这种格式 直接去 启动器 看看 找到 send 下一页 看看数据加密传输过程



![image-20260119210711370](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119210711370.png)

还没有 继续想上找 看看 哪里 是加密和不加密之间的内容 继续跟栈

然后向上找 可以发现 上面的url没有加密参数 下面就有了 所以这块打上断点	

![image-20260119211118108](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119211118108.png)

重新翻页

![image-20260119211302631](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119211302631.png)

找到了 加密内容 存储在 `l.data`中了

看看 `l.data` 哪里被赋值的

![image-20260119211338903](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119211338903.png)

我们持续输出 l.data看看

![image-20260119211438674](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119211438674.png)

可以发现了 这里就是关键生成 函数 因为 上面 没有生成` ts `和` sn` 我们进入看看

一直 单步执行 看看 url 什么时候 拼接上  就可以定位到函数

![image-20260119212643464](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119212643464.png)

可以发现出现关键点了

![image-20260119212723837](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119212723837.png)大家可以看控制台输出的 原本是没有 ts的 但是上面 执行完毕后 就添加上了 ts 所以这就是 关键数据的一个地方



![image-20260119212932066](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119212932066.png)

所以这里就确定了第一个函数 就是时间戳

继续单步 看看 第二个参数

![image-20260119213247557](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119213247557.png)

找到最后加密的地方了 下断点直接看

![image-20260119213448699](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119213448699.png)

完美复原 ：

![image-20260119213903791](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119213903791.png)

下面要搞懂两个 

1. 是不是标准哈希算法
2. `_0xe7fex34` 如何生成的

去爬虫工具库看看 `https://spidertools.cn/#/crypto`

![image-20260119214048613](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119214048613.png)

就是标准的 `md5` 所以简单了

经过多次翻页 发现`_0xe7fex34`  都是不变的所以这里 就是固定值

![image-20260119214238874](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260119214238874.png)

到此就结束了

1. ts 是时间戳
2. sn是 `hash(JSON.stringify(传输的数据)+"c9d6618dbc657b41a66eb0af952906f1").slice(2,12)`

# 生成爬虫脚本

通过 爬虫工具库 快速生成`request `

```python
import requests
from collections import OrderedDict
import time, json, hashlib

salt = "c9d6618dbc657b41a66eb0af952906f1"

//创建一个 有序字典
data = OrderedDict()
//对字典内容 添加数据
data["_ts"] = str(int(time.time() * 1000))
data["keyword_id"] = "0"
data["page"] = "4"
data["poi_id"] = "38322"
data["type"] = "0"

//类比 JSON.stringify  去掉 JSON 里面的空格 
json_str = json.dumps(data, separators=(",", ":"), ensure_ascii=False)
raw = json_str + salt

//md5加密
md5_hex = hashlib.md5(raw.encode("utf-8")).hexdigest()
sn = md5_hex[2:12] 


headers = {
    "accept": "application/json, text/javascript, */*; q=0.01",
    "accept-language": "zh-CN,zh;q=0.9",
    "priority": "u=1, i",
    "referer": "https://www.mafengwo.cn/hotel/38322.html",
    "sec-ch-ua": "\\Google",
    "sec-ch-ua-mobile": "?0",
    "sec-ch-ua-platform": "\\Windows",
    "sec-fetch-dest": "empty",
    "sec-fetch-mode": "cors",
    "sec-fetch-site": "same-origin",
    "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
    "x-requested-with": "XMLHttpRequest"
}

url = "https://www.mafengwo.cn/hotel/info/comment_list"
params = {
    "poi_id": "38322",
    "type": "0",
    "keyword_id": "0",
    "page": "4",
    "_ts": data["_ts"],
    "_sn": sn
}
response = requests.get(url, headers=headers,  params=params)

print(response.text)
print(response)
```

这样就完全完美的获取到数据了
![Capturer_2026-01-19_215717_393](https://raw.githubusercontent.com/Xioaruan912/pic/main/Capturer_2026-01-19_215717_393.gif)
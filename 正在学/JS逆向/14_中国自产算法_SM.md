SM 是通过 国家密码管理局 发布的

系列有：

```
sm 1 2 3 4 7 9 
ZUC //祖冲之加密算法
```

1. `SM2/3/4` 可以被使用于商业用途 【我们要学的】
2. `SM2`是 非对称加密 基于 椭圆曲线ECC的加密算法 256位 对比RSA 处理速度更快
3. `SM3`是 哈希函数算法 用于完整性 压缩函数更加复杂
4. `SM4`是 对称加密算法 分组长度和计算长度都是 128位 计算轮数多

# 使用

`npm install sm-crypto`

非对称加密 SM2：

```js
const SM = require("sm-crypto").sm2
 
const text = "明文数据"

//生成密钥对
const keypair = SM.generateKeyPairHex();

const pub = keypair.publicKey
const key = keypair.privateKey

const enc = SM.doEncrypt(text,pub)

console.log("加密结果："+enc)

const dec = SM.doDecrypt(enc,key)

console.log("解密结果："+dec)
```

哈希算法 SM3：

```js
const SM3 = require("sm-crypto").sm3

const text = "明文数据"

var enc  = SM3(text)

console.log("加密结果："+enc)
```

对称加密算法 SM4：

这里注意 `SM4`的`KEY` 需要 16字节的

```js
const SM4 = require("sm-crypto").sm4

const text = '明文数据';
const key = '0123456789abcdef0123456789abcdef';

const enc = SM4.encrypt(text, key); 
console.log('加密结果：', enc);

const dec = SM4.decrypt(enc, key);
console.log('解密结果：', dec);
```

# 实战1

http://121.196.216.83/migu.html

算法就在html中

```
		<script>
		  var str ="123456";
		  var key = "04f097212e63d49c0189c9df6c78903a7ff353ee5eb1563ac410777be22a4c2193e81c5b16c3048b36598057cd07b352754e9f613e8d2cf3e891eba5751e0d6f30";
		  var value =  MiguplayUtils.crypto.cryptoPhone(str, key);
		  document.getElementById("test").innerText = "咪咕："+value;
		  
		  document.getElementById("test2").innerText = "宁夏："+ cmen('1');
		 
		</script>
```

跟入代码是这样的

```js
const SM = require('sm-crypto').sm2

var str ="123456";
var key = "04f097212e63d49c0189c9df6c78903a7ff353ee5eb1563ac410777be22a4c2193e81c5b16c3048b36598057cd07b352754e9f613e8d2cf3e891eba5751e0d6f30";

// document.getElementById("test2").innerText = "宁夏："+ cmen('1');
const enc = SM.doEncrypt(str + '', key || key , 0x1)
var res = '04' +enc ;
console.log(res)
```

# 实战2

https://basic.jxeduyun.com/zhjy-login/?nextpage=aHR0cHM6Ly9iYXNpYy5qeC5zbWFydGVkdS5jbi9kZXNrdG9wL2xvZ2luLw==#/mobile/login?nextpage=aHR0cHM6Ly9iYXNpYy5qeC5zbWFydGVkdS5jbi9kZXNrdG9wL2xvZ2luLw%3D%3D

通过启动器断点

![image-20260116133548087](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260116133548087.png)

发现这个时候已经断了 所以我们跟栈

![image-20260116133622199](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260116133622199.png)

直接定位 可以发现 上面是 `SM4` 那我们猜测多半就是了

![image-20260116133655235](https://raw.githubusercontent.com/Xioaruan912/pic/main/image-20260116133655235.png)

这里由于 `sm-crypto`的key有固定长度 所以我们引入另一个库 `gm-crypt`

```js
const SM4 = require('gm-crypt').sm4;

const sm4Config = {
  key: 'a85ec9f77459825e',   // gm-crypt 这里通常当作“16字符key(UTF-8)”使用
  mode: 'ecb',              // ecb 不需要 iv
  cipherType: 'base64'      // 输出 base64
};

const sm4 = new SM4(sm4Config);

const plaintext = 'asdasdasd';
const cipherText = sm4.encrypt(plaintext);
console.log('cipher(base64)=', cipherText);

// 解密校验
const decrypted = sm4.decrypt(cipherText);
console.log('decrypted=', decrypted);

```

